{% extends "maker/base.html" %}
{% load i18n %}
{% load sass_tags %}
{% load static %}

{% block title %}{% trans 'Choose from Repos' %}{% endblock %}

{% block head %}
<link href="{% sass_src 'maker/css/forms.scss' %}" rel="stylesheet" type="text/css" media="all">
{% endblock head %}

{% block rm-header-classes %}rm-header--light{% endblock rm-header-classes %}
{% block toolbar %}
<div class="rm-grid--full-width rm-grid--center mdl-grid">
	<div class="rm-app-toolbar mdl-cell mdl-cell--8-col">
		<!-- Title -->
		<span class="rm-repo-add-toolbar-title">
			{% trans 'Choose from Repos' %}
		</span>
		<div>
			<span class="rm-repo-add-toolbar-count">
				<i class="material-icons">done</i>
				<!-- TODO: Make app count working -->
				{% blocktrans with apps_count='<span id="rm-repo-add-toolbar-count-span">2</span>' trimmed %}
				{{ apps_count }} added
				{% endblocktrans %}
			</span>
			<a href="{% url 'repo' repo.id %}" class="rm-repo-add-toolbar-done">
				<button>{% trans 'Done' %}</button>
			</a>
		</div>
	</div>
</div>
{% endblock toolbar %}

{% block rm-content %}
<div class="rm-app-add-container">
	<div class="rm-app-add ">
			<div class="rm-app-add-search">
				<form action="{% url 'app_search' repo.id %}" method="get">
					{% csrf_token %}
					<div class="rm-app-add-search-field mdl-js-textfield">
						<i class="material-icons">search</i>
						<input type="text" name="query" class="rm-app-add-search-field-input"
						{% if request.GET.query %}value="{{ request.GET.query }}" {% endif %}/>
					</div>
				</form>

				<div class="rm-app-add-filters-title">{% trans 'Filters' %}</div>

				<hr class="rm-app-add-divider" />

				<div class="rm-app-filter-section">
					<span>{% trans 'Repos' %}</span>
					<a href="{% url 'add_remote_repo' %}" class="rm-app-add-categories-clear">{% trans 'Add' %}</a>
				</div>

				<ul class="rm-app-add-repositories-list">
					<li class="rm-app-add-repositories-list-item{%if not remote_repo %} active{% endif %}">
						<a href="{% url 'add_app' repo.id %}">{% trans 'All' %}</a>
					</li>
					{% for r in repos %}
					<li class="rm-app-add-repositories-list-item{%if r == remote_repo %} active{% endif %}">
						<a href="{% url 'add_app_from_remote' repo.id r.id %}">{{ r }}</a>
					</li>
					{% endfor %}
				</ul>

				<div class="rm-app-filter-section">
					<span>{% trans 'Categories' %}</span>
					<!-- TODO: Only clear categories, not search and repos too -->
					<a class="rm-app-add-categories-clear" href="{% url 'add_app' repo.id %}">{% trans 'clear' %}</a>
				</div>
				<!-- TODO: Handle selection -->
				<div class="rm-app-add-categories-list">
					{% for category in categories %}
						<button name="category" value="{{ category.id }}" class="rm-app-add-categories-list-item">
							<div class="rm-app-add-categories-list-item-circle"></div>
							<div class="rm-app-add-categories-list-item-title">{{ category }}</div>
						</button>
					{% endfor %}
				</div>
			</div>
			<div class="rm-app-add-apps">
				{% if remote_repo %}
				<div class="rm-app-add-remote-repository-information">
					<h1 class="rm-app-add-remote-repository-information-title">{{ remote_repo.name }}</h1>
					<p class="rm-app-add-remote-repository-information-description">{{ remote_repo.description }}</p>
					<hr class="rm-app-add-remote-repository-information-divider" />
				</div>
				{% endif %}
				<!-- TODO: Add should add app asynchronously in the background, updating the count at the top -->
				{% csrf_token %}
				{% for app in apps %}
					{% url 'add_remote_app' repo.id app.repo.id app.id as url %}
					{% trans 'Add' as action_title %}
					{% include "maker/widgets/app_with_action.html" with url=url width=12 action_title=action_title %}
				{% empty %}
					<p>
						{% trans 'There are no apps from remote repositories.' %}
						{% trans 'If you just added a remote repository, wait for the apps to download and try again later.' %}
					</p>
				{% endfor %}
			</div>
	</div>
</div>

<script src="{% static 'maker/js/app/add.js' %}"></script>
{% endblock rm-content %}
